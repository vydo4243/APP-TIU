import React from 'react';
import { View, StyleSheet, Text, TouchableOpacity } from 'react-native';
import { WebView } from 'react-native-webview';
import Back_light from '~/assets/icons/Back_light.svg';
import { usePathname, useRouter } from 'expo-router';
import AsyncStorage from '@react-native-async-storage/async-storage';

export default function MapScreen() {
  const router = useRouter();
  const pathname = usePathname();
  const isActive = (href: string) => pathname === href;
  const htmlContent = `
    <html>
    <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />

      <title>Starter app in 3D - 4.15</title>

      <link rel="stylesheet" href="https://js.arcgis.com/4.15/esri/themes/light/main.css" />
      <script src="https://js.arcgis.com/4.15/"></script>

      <style>
        html,
        body,
        #viewDiv {
          padding: 0;
          margin: 0;
          height: 100%;
          width: 100%;
        }
      </style>
      <script>
        require([
          "esri/Map",
          "esri/views/SceneView",
          "esri/layers/GraphicsLayer",
          "esri/geometry/Mesh",
          "esri/geometry/Point",
          "esri/Graphic",
        ], function (
          Map,
          SceneView,
          GraphicsLayer,
          Mesh,
          Point,
          Graphic
        ) {
          const sketchLayer = new GraphicsLayer({
            elevationInfo: {
              mode: "absolute-height"
            },
            title: "Sketched geometries"
          });
          const map = new Map({
            basemap: "topo-vector",
            ground: "world-elevation"
          });

          const view = new SceneView({
            container: "viewDiv",
            map: map,
            camera: {
              position: [106.803115, 10.866924, 300],
              heading: 0,
              tilt: 50
            }
          });

          var jsondata = ${JSON.stringify({
            lines: [
              {
                type: 'polyline',
                paths: [
                  [106.80268054921868, 10.870228532143827],
                  [106.80251171515926, 10.87006399314069],
                  [106.80273210160311, 10.869969699594861],
                  [106.80293831114153, 10.869888695718572],
                  [106.80292836382506, 10.869656129403353],
                  [106.8029103299458, 10.869627792877353],
                  [106.80278950296099, 10.869608311515293],
                ],
                symbol: {
                  type: 'simple-line',
                  color: [255, 255, 255],
                  width: 4,
                },
              },
              {
                type: 'polyline',
                paths: [
                  [106.80324712030796, 10.870538163274432],
                  [106.8032583948476, 10.870137549713988],
                  [106.80307085213235, 10.869954450605903],
                  [106.80293965749553, 10.86989003024479],
                  [106.80333016653015, 10.869870905447769],
                  [106.80374536149048, 10.869802458832638],
                ],
                symbol: {
                  type: 'simple-line',
                  color: [255, 255, 255],
                  width: 4,
                },
              },
              {
                type: 'polyline',
                paths: [
                  [106.8037427928574, 10.869810189439107],
                  [106.80376169783074, 10.869763774975908],
                  [106.80382854041454, 10.869743219995598],
                  [106.8038812042683, 10.869773057869367],
                  [106.80389200711039, 10.869801569611255],
                  [106.80389403264286, 10.869837375051205],
                  [106.80387242695991, 10.8698672129143],
                  [106.80383394183491, 10.869882463376854],
                  [106.80379073046788, 10.86988180031382],
                  [106.8037542708766, 10.869856603896338],
                  [106.80374211767906, 10.869810852503562],
                ],
                symbol: {
                  type: 'simple-line',
                  color: [255, 255, 255],
                  width: 4,
                },
              },
              {
                type: 'polyline',
                paths: [
                  [106.80431526443346, 10.870256171531949],
                  [106.80433945332288, 10.87023057671587],
                  [106.80437060526032, 10.870186618801824],
                  [106.80442473432271, 10.87008993333302],
                  [106.80443804522707, 10.870011482770877],
                ],
                symbol: {
                  type: 'simple-line',
                  color: [255, 255, 255],
                  width: 4,
                },
              },
              {
                type: 'polyline',
                paths: [
                  [106.80388531815748, 10.86978089085568],
                  [106.80422218661619, 10.869781614759873],
                  [106.80450220844392, 10.869792538982281],
                  [106.8046319433426, 10.869690468399838],
                  [106.80487739286912, 10.869919932979116],
                  [106.80486117600731, 10.869950336962859],
                  [106.80485898267443, 10.870085773853077],
                  [106.80483904219096, 10.870389302265082],
                ],
                symbol: {
                  type: 'simple-line',
                  color: [255, 255, 255],
                  width: 4,
                },
              },
              {
                type: 'polyline',
                paths: [
                  [106.80485993752615, 10.870084355207979],
                  [106.8046021381864, 10.870089250832493],
                  [106.80460712325657, 10.87002211083248],
                ],
                symbol: {
                  type: 'simple-line',
                  color: [255, 255, 255],
                  width: 4,
                },
              },
              {
                type: 'polyline',
                paths: [
                  [106.80324711938545, 10.870125278694275],
                  [106.80340102250887, 10.87028033590822],
                ],
                symbol: {
                  type: 'simple-line',
                  color: [191, 196, 215],
                  width: 6,
                },
              },
              {
                type: 'polyline',
                paths: [
                  [106.80302014444027, 10.87183194569468],
                  [106.80341235472213, 10.871550202660558],
                  [106.80359122978967, 10.871390425975406],
                  [106.80454180802491, 10.870695614557519],
                  [106.80456374475472, 10.870644981957994],
                  [106.80457048184661, 10.870601835012906],
                  [106.8045609790978, 10.870540468461257],
                  [106.80449478468984, 10.870449984148479],
                  [106.80415820274754, 10.870108010862637],
                ],
                symbol: {
                  type: 'simple-line',
                  color: [191, 196, 215],
                  width: 6,
                },
              },
              {
                type: 'polyline',
                paths: [
                  [106.80486542921136, 10.870387797668656],
                  [106.80444890854864, 10.870400025502676],
                ],
                symbol: {
                  type: 'simple-line',
                  color: [191, 196, 215],
                  width: 6,
                },
              },
              {
                type: 'polyline',
                paths: [
                  [106.80203270269345, 10.870541875533675],
                  [106.80218430316467, 10.870404023537091],
                  [106.80218979731364, 10.87039405497488],
                  [106.80250996534664, 10.87006531705893],
                  [106.80231220381972, 10.87012640022624],
                  [106.80231087294732, 10.870122028007785],
                  [106.80195654211025, 10.870448783100898],
                ],
                symbol: {
                  type: 'simple-line',
                  color: [191, 196, 215],
                  width: 10,
                },
              },
              {
                type: 'polyline',
                paths: [
                  [106.80218979731364, 10.87039405497488],
                  [106.80325801798153, 10.87137371855485],
                  [106.80341106368701, 10.871549525692373],
                ],
                symbol: {
                  type: 'simple-line',
                  color: [191, 196, 215],
                  width: 10,
                },
              },
              {
                type: 'polyline',
                paths: [
                  [106.80325866555188, 10.871377926370101],
                  [106.80324652003469, 10.870527093765673],
                  [106.80340101060551, 10.870279962858746],
                  [106.80340102250887, 10.87028033590822],
                  [106.80382764515724, 10.870288167078058],
                  [106.80393370275112, 10.870250577458577],
                  [106.80402460915877, 10.870209071714527],
                  [106.80415219723989, 10.870111965162636],
                  [106.80420961187667, 10.870007027402153],
                  [106.80423399037448, 10.869949522187909],
                  [106.8042459517576, 10.869853198669304],
                  [106.80422920582089, 10.869720068552809],
                  [106.80417896740033, 10.869682479225304],
                  [106.80391103242908, 10.8696441064112],
                  [106.80383288472933, 10.869639407698429],
                  [106.80381128753532, 10.869338414230668],
                  [106.80382723657027, 10.8692366085629],
                  [106.80367094117076, 10.86930708933457],
                  [106.80322438221646, 10.869275764545975],
                  [106.80279456990377, 10.869312571179947],
                  [106.80242217170769, 10.869357992371349],
                  [106.802330467773, 10.869478592744045],
                  [106.80231220381972, 10.87012640022624],
                ],
                symbol: {
                  type: 'simple-line',
                  color: [191, 196, 215],
                  width: 10,
                },
              },
              {
                type: 'polyline',
                paths: [
                  [106.8038232102653, 10.869230849053437],
                  [106.80401280613654, 10.868892496864191],
                ],
                symbol: {
                  type: 'simple-line',
                  color: [191, 196, 215],
                  width: 10,
                },
              },
            ],
            border: [
              {
                type: 'polygon',
                rings: [
                  [106.80295316402515, 10.871831923852653],
                  [106.80216554926983, 10.870647822600617],
                  [106.80112328274026, 10.86961486678824],
                  [106.80272971188816, 10.867999692350779],
                  [106.80396435149027, 10.868888625936023],
                  [106.80520488044033, 10.870214393287469],
                  [106.80295316402515, 10.871831923852653],
                ],
                symbol: {
                  type: 'simple-line',
                  color: [0, 0, 0],
                  width: 4,
                },
              },
            ],
            tower: [
              {
                type: 'polygon',
                rings: [
                  [106.80277627182193, 10.869516612168255],
                  [106.80260613125739, 10.869516308412486],
                  [106.80260481292669, 10.869404619177402],
                  [106.8027730720384, 10.869403701819124],
                  [106.80277542716777, 10.869335714363075],
                  [106.80294974236762, 10.869327883339636],
                  [106.80352504540667, 10.869327737896995],
                  [106.80366820966663, 10.869333561846659],
                  [106.80366805952144, 10.869438164203515],
                  [106.80372710733042, 10.869438819934246],
                  [106.80372813998093, 10.869491353684055],
                  [106.80366832112742, 10.869491018141986],
                  [106.8036694395181, 10.869587389161552],
                  [106.80351328746622, 10.869588576928237],
                  [106.80351237311095, 10.869554924835668],
                  [106.80345697624415, 10.869554851975806],
                  [106.80345621331583, 10.869599326728888],
                  [106.80341412657941, 10.869598389602444],
                  [106.80341372850245, 10.869557075055084],
                  [106.80335937889271, 10.869556474161286],
                  [106.803359803528, 10.869593670770527],
                  [106.8027764706564, 10.869597520784453],
                  [106.80277627182193, 10.869516612168255],
                ],
                symbol: {
                  type: 'simple-fill',
                  color: [200, 212, 243],
                  outline: {
                    color: [0, 0, 0, 0.3],
                    width: 1,
                  },
                },
              },
              {
                type: 'polygon',
                rings: [
                  [106.80371540288235, 10.868900819668127],
                  [106.8036155558625, 10.868822212501428],
                  [106.80367671515859, 10.868747414945176],
                  [106.80377673405678, 10.868827632619727],
                  [106.80371540288235, 10.868900819668127],
                ],
                symbol: {
                  type: 'simple-fill',
                  color: [223, 220, 247],
                  outline: {
                    color: [0, 0, 0, 0.3],
                    width: 1,
                  },
                },
              },
              {
                type: 'polygon',
                rings: [
                  [106.80242541550399, 10.869712329720642],
                  [106.80242091221163, 10.869709990963244],
                  [106.80241036746162, 10.86971061982149],
                  [106.80239790584017, 10.869709990963244],
                  [106.80239381068031, 10.869707796203173],
                  [106.80238633400052, 10.869705922672892],
                  [106.80238226509243, 10.869702506172871],
                  [106.8023831230077, 10.869697578569713],
                  [106.80237942044243, 10.869695743375289],
                  [106.80238096414291, 10.86967653786408],
                  [106.8027198859541, 10.869675581653269],
                  [106.80275357684167, 10.869727027404181],
                  [106.80280381188743, 10.869729046916746],
                  [106.80281214778415, 10.869747624392886],
                  [106.80281649419419, 10.869769467394335],
                  [106.80282247664013, 10.869794317989516],
                  [106.80282281702785, 10.86980807462163],
                  [106.80281891500789, 10.869810461275137],
                  [106.80282105995781, 10.869816650357919],
                  [106.80281494165524, 10.869823616243238],
                  [106.80281091799344, 10.869821516519039],
                  [106.80279921240464, 10.869828549180795],
                  [106.80278297722322, 10.869826781993325],
                  [106.80275728225217, 10.869818382964823],
                  [106.80273400204396, 10.869804838839386],
                  [106.80273204955415, 10.869776706892068],
                  [106.8027115741611, 10.86977555442158],
                  [106.80271264531967, 10.869803648259307],
                  [106.80242532381243, 10.869802459304651],
                  [106.80242541550399, 10.869712329720642],
                ],
                symbol: {
                  type: 'simple-fill',
                  color: [255, 255, 255],
                  outline: {
                    color: [0, 0, 0, 0.3],
                    width: 1,
                  },
                },
              },
              {
                type: 'polygon',
                rings: [
                  [106.8044993822212, 10.869825792615586],
                  [106.80460604389515, 10.869729767243442],
                  [106.80471754091292, 10.869837189418078],
                  [106.804670623388, 10.869891984296018],
                  [106.80467199882872, 10.870032151383157],
                  [106.80461086370065, 10.870031521428501],
                  [106.80459890029789, 10.870033751836402],
                  [106.80458692499508, 10.870042748289563],
                  [106.8045262162413, 10.870044562086179],
                  [106.80450335028996, 10.870031966916287],
                  [106.8044390200551, 10.870029298428292],
                  [106.80442270675064, 10.87002974243751],
                  [106.80442133787898, 10.869995973314758],
                  [106.80441107189716, 10.869989341861398],
                  [106.80439194171828, 10.869985887990396],
                  [106.80437095154423, 10.869971829817942],
                  [106.80435721798972, 10.869956420479113],
                  [106.8043525955103, 10.869944191583528],
                  [106.80435057580894, 10.869915769361043],
                  [106.80434884060344, 10.86990326671274],
                  [106.8043512381659, 10.869899440241298],
                  [106.80435218391756, 10.869882287716592],
                  [106.80436296445373, 10.869862370186596],
                  [106.80440418998921, 10.869828482642745],
                  [106.80442806184476, 10.86982772488696],
                  [106.80443167289116, 10.869824703138917],
                  [106.8044993822212, 10.869825792615586],
                ],
                symbol: {
                  type: 'simple-fill',
                  color: [233, 207, 214],
                  outline: {
                    color: [0, 0, 0, 0.3],
                    width: 1,
                  },
                },
              },
              {
                type: 'polygon',
                rings: [
                  [106.80397771397253, 10.869547350519596],
                  [106.80400355235491, 10.869280559068386],
                  [106.80409915603269, 10.869289370139867],
                  [106.80408104634876, 10.86947480578334],
                  [106.80418941038556, 10.869485302425588],
                  [106.80418351871651, 10.869563774309896],
                  [106.80397771397253, 10.869547350519596],
                ],
                symbol: {
                  type: 'simple-fill',
                  color: [240, 206, 226],
                  outline: {
                    color: [0, 0, 0, 0.3],
                    width: 1,
                  },
                },
              },
              {
                type: 'polygon',
                rings: [
                  [106.80233547579456, 10.870720725095907],
                  [106.80241666554014, 10.870639913981734],
                  [106.8028967781039, 10.871077969731303],
                  [106.8032312703561, 10.871398405833546],
                  [106.80312169886025, 10.871509040773063],
                  [106.80233547579456, 10.870720725095907],
                ],
                symbol: {
                  type: 'simple-fill',
                  color: [240, 236, 226],
                  outline: {
                    color: [0, 0, 0, 0.3],
                    width: 1,
                  },
                },
              },
              {
                type: 'polygon',
                rings: [
                  [106.8031112737201, 10.87152140966242],
                  [106.8031112737201, 10.871516347679531],
                  [106.80325817676498, 10.871434512275655],
                  [106.80326461988227, 10.87143619960402],
                  [106.80330671490685, 10.871510863864955],
                  [106.80330542628315, 10.87151592584793],
                  [106.80328652647694, 10.871527315309152],
                  [106.80328523785312, 10.871532377291885],
                  [106.8033092921529, 10.871575825974205],
                  [106.80330800352908, 10.871580887956881],
                  [106.8031881615724, 10.871648381041666],
                  [106.80318257753811, 10.871646693714482],
                  [106.8031112737201, 10.87152140966242],
                ],
                symbol: {
                  type: 'simple-fill',
                  color: [240, 236, 226],
                  outline: {
                    color: [0, 0, 0, 0.3],
                    width: 1,
                  },
                },
              },
            ],
            polygons: [
              {
                type: 'polygon',
                rings: [
                  [106.80386213832344, 10.86966683188517],
                  [106.8039101258754, 10.869667902943078],
                  [106.80416151521297, 10.869702176826905],
                  [106.80419750587788, 10.86972734670833],
                  [106.80420677620015, 10.869766975876956],
                  [106.80386813676762, 10.86975465870411],
                  [106.80386213832344, 10.86966683188517],
                ],
                symbol: {
                  type: 'simple-fill',
                  color: [157, 223, 186],
                  outline: {
                    color: [0, 0, 0, 0.0],
                    width: 1,
                  },
                },
              },
              {
                type: 'polygon',
                rings: [
                  [106.80234392454844, 10.869983350401924],
                  [106.80235301028995, 10.869492600242253],
                  [106.80243088808368, 10.869382978018749],
                  [106.80277614629733, 10.869339638988734],
                  [106.80277355037026, 10.869382978018749],
                  [106.802608709043, 10.869388076727432],
                  [106.80261000700648, 10.8695180937775],
                  [106.80255549255145, 10.869579278251592],
                  [106.80269956646714, 10.869585651633571],
                  [106.8027112481372, 10.869599673073736],
                  [106.8027748483338, 10.869691449755479],
                  [106.80281768112047, 10.86970292183831],
                  [106.80285142816399, 10.869719492624412],
                  [106.80285272612593, 10.869860981606905],
                  [106.80254251291933, 10.869959131582235],
                  [106.8024282921566, 10.86990177121055],
                  [106.80234392454844, 10.869983350401924],
                ],
                symbol: {
                  type: 'simple-fill',
                  color: [157, 223, 186],
                  outline: {
                    color: [0, 0, 0, 0.0],
                    width: 1,
                  },
                },
              },
              {
                type: 'polygon',
                rings: [
                  [106.8048243840376, 10.87033757509991],
                  [106.80441732647756, 10.870342869848045],
                  [106.80421514556974, 10.870129756147747],
                  [106.80423413708706, 10.870095536105865],
                  [106.80426015415873, 10.870044805884618],
                  [106.80429510454576, 10.869973205269787],
                  [106.80430905195726, 10.869893305146235],
                  [106.80431253880943, 10.86984422363247],
                  [106.80431486337847, 10.869804273556753],
                  [106.80443225408743, 10.869808839279713],
                  [106.80451477626917, 10.869812263571504],
                  [106.8046054344411, 10.869728939112079],
                  [106.80471817601341, 10.869833950755293],
                  [106.80484602728171, 10.869949235235083],
                  [106.8048471895662, 10.870073651106878],
                  [106.8048243840376, 10.87033757509991],
                ],
                symbol: {
                  type: 'simple-fill',
                  color: [157, 223, 186],
                  outline: {
                    color: [0, 0, 0, 0.0],
                    width: 1,
                  },
                },
              },
              {
                type: 'polygon',
                rings: [
                  [106.80190356261522, 10.870329912872094],
                  [106.80163278280031, 10.870032170540526],
                  [106.80159949541013, 10.869703379629371],
                  [106.80162695213289, 10.869468395457076],
                  [106.80156844486498, 10.869245638986342],
                  [106.8016061413287, 10.869140873605147],
                  [106.80171316484416, 10.869023308508105],
                  [106.80180706143733, 10.868939050517696],
                  [106.80239499308107, 10.868923031877316],
                  [106.80274068932226, 10.868535081565085],
                  [106.80321288317907, 10.868813807278002],
                  [106.80321444832884, 10.86895997129406],
                  [106.80320688910808, 10.869262695383242],
                  [106.80284544447136, 10.869380835199877],
                  [106.80260669985438, 10.869386477009272],
                  [106.8026106982245, 10.869528497249547],
                  [106.80255748110426, 10.869582305769896],
                  [106.8026715973038, 10.86958031589107],
                  [106.80271529319754, 10.869601924508459],
                  [106.80276905440496, 10.869691653194579],
                  [106.80285258543296, 10.869719225599695],
                  [106.80285513084232, 10.8698600773088],
                  [106.80254786788657, 10.869963811531562],
                  [106.8024327010483, 10.869906494567743],
                  [106.8020219350239, 10.870298866413407],
                  [106.80190356261522, 10.870329912872094],
                ],
                symbol: {
                  type: 'simple-fill',
                  color: [157, 223, 186],
                  outline: {
                    color: [0, 0, 0, 0.0],
                    width: 1,
                  },
                },
              },
              {
                type: 'polygon',
                rings: [
                  [106.8016177976433, 10.869898744994217],
                  [106.80184886452935, 10.868715737530579],
                  [106.80196603003594, 10.86875107854263],
                  [106.8019869524465, 10.868776556944525],
                  [106.80201959141027, 10.868808610415314],
                  [106.80209240140186, 10.868747791006939],
                  [106.80223048931902, 10.868684505934198],
                  [106.80232012633098, 10.868665080726814],
                  [106.80234439632824, 10.868691381019417],
                  [106.80247019279585, 10.868456982427972],
                  [106.8026246274656, 10.868172393483576],
                  [106.80269994814722, 10.8680326729056],
                  [106.80273091331571, 10.86799075671955],
                  [106.80276522607085, 10.868017057072564],
                  [106.80324612990597, 10.868384892032992],
                  [106.80347711333059, 10.868547625214092],
                  [106.80388839227504, 10.868834631637682],
                  [106.80397466852168, 10.8688931067867],
                  [106.803818168882, 10.869192272257862],
                  [106.80380645233078, 10.869124055981587],
                  [106.80378552992016, 10.86910022137576],
                  [106.80332749688148, 10.868857186105402],
                  [106.80329653171287, 10.868855542338636],
                  [106.8032612265111, 10.868872801354257],
                  [106.80321519720661, 10.868835816588827],
                  [106.80321603410329, 10.868962386656776],
                  [106.80316916790025, 10.868934442619818],
                  [106.8029582699915, 10.868933620736186],
                  [106.80281639669937, 10.868995001489907],
                  [106.80281137532137, 10.869036917534899],
                  [106.80280216946016, 10.86922841625443],
                  [106.80280040011075, 10.869284062752698],
                  [106.80240873256503, 10.869331731933116],
                  [106.80238563430913, 10.869355862323346],
                  [106.80221407053347, 10.869369012439975],
                  [106.80200276836007, 10.86964996232318],
                  [106.80201929158568, 10.870299346993207],
                  [106.80190379987431, 10.87032729090231],
                  [106.80153243420386, 10.869919292013506],
                  [106.8016177976433, 10.869898744994217],
                ],
                symbol: {
                  type: 'simple-fill',
                  color: [157, 223, 186],
                  outline: {
                    color: [0, 0, 0, 0.0],
                    width: 1,
                  },
                },
              },
              {
                type: 'polygon',
                rings: [
                  [106.80403899770931, 10.868969497730305],
                  [106.80436048296627, 10.869302198391367],
                  [106.80453362950215, 10.869477537900508],
                  [106.80451403821559, 10.869515165584176],
                  [106.80465476274878, 10.86964131718807],
                  [106.80450393491515, 10.869778808201346],
                  [106.80429681726883, 10.869774555902765],
                  [106.80422354853539, 10.869625093473246],
                  [106.80396663605472, 10.869594618650424],
                  [106.80386560305709, 10.869605958119777],
                  [106.8038629116271, 10.869223218781869],
                  [106.80387662324802, 10.869201248531681],
                  [106.80392930474011, 10.869194161353917],
                  [106.80403899770931, 10.868969497730305],
                ],
                symbol: {
                  type: 'simple-fill',
                  color: [157, 223, 186],
                  outline: {
                    color: [0, 0, 0, 0.0],
                    width: 1,
                  },
                },
              },
              {
                type: 'polygon',
                rings: [
                  [106.80329415784291, 10.871377676332997],
                  [106.80329568715547, 10.871195190666995],
                  [106.8032842288905, 10.870860424692069],
                  [106.80327684529908, 10.870541130805407],
                  [106.80342007361776, 10.870307638099007],
                  [106.80383718220799, 10.870318752283069],
                  [106.80388158298803, 10.870301873285285],
                  [106.80394460344797, 10.870279367955092],
                  [106.80398041052797, 10.870259675788489],
                  [106.80407780578417, 10.870203412449243],
                  [106.80416342189528, 10.870136321726676],
                  [106.80448060390273, 10.870455903708148],
                  [106.80451095105542, 10.870497977973798],
                  [106.80454754615158, 10.870544434967911],
                  [106.80455468665787, 10.870598780876435],
                  [106.80454933127896, 10.870640855121124],
                  [106.80452969488579, 10.870685559000762],
                  [106.8043181573766, 10.87084246079661],
                  [106.80406494865679, 10.871028487471378],
                  [106.8039132128917, 10.871141561828608],
                  [106.80373950977298, 10.871268957443945],
                  [106.80359495462847, 10.871374709655555],
                  [106.80352164775621, 10.871439907981298],
                  [106.80342864586788, 10.871505273583566],
                  [106.80340767485433, 10.87148557436251],
                  [106.80329415784291, 10.871377676332997],
                ],
                symbol: {
                  type: 'simple-fill',
                  color: [157, 223, 186],
                  outline: {
                    color: [0, 0, 0, 0.0],
                    width: 1,
                  },
                },
              },
              {
                type: 'polygon',
                rings: [
                  [106.8022459833295, 10.87038917706937],
                  [106.80253350072951, 10.87011784471784],
                  [106.80268848046171, 10.87024862216002],
                  [106.80318822593864, 10.87013160853347],
                  [106.80323367089562, 10.870142139100537],
                  [106.80322531647414, 10.870489468383397],
                  [106.80322710363464, 10.870523818048255],
                  [106.80322506116414, 10.870527077504775],
                  [106.80324248490467, 10.871139648915573],
                  [106.80324866022175, 10.87133708552706],
                  [106.80315872679006, 10.871256234287301],
                  [106.80298591479738, 10.871092492862743],
                  [106.80241979777878, 10.870556058676783],
                  [106.8022459833295, 10.87038917706937],
                ],
                symbol: {
                  type: 'simple-fill',
                  color: [157, 223, 186],
                  outline: {
                    color: [0, 0, 0, 0.0],
                    width: 1,
                  },
                },
              },
              {
                type: 'polygon',
                rings: [
                  [106.80324551705445, 10.869259880369796],
                  [106.80321204019515, 10.869094841370767],
                  [106.80325020381434, 10.868915994224821],
                  [106.80329974956692, 10.868852214150593],
                  [106.80377980773346, 10.869096813948644],
                  [106.80380591968361, 10.869222401401814],
                  [106.80366263872475, 10.869286181396944],
                  [106.80324551705445, 10.869259880369796],
                ],
                symbol: {
                  type: 'simple-fill',
                  color: [157, 223, 186],
                  outline: {
                    color: [0, 0, 0, 0.0],
                    width: 1,
                  },
                },
              },
              {
                type: 'polygon',
                rings: [
                  [106.80302184099645, 10.86924646271055],
                  [106.8030100741139, 10.869164994411292],
                  [106.8030100741139, 10.869045969763278],
                  [106.80314951167367, 10.869047125341524],
                  [106.8031389214782, 10.869247618289336],
                  [106.80302184099645, 10.86924646271055],
                ],
                symbol: {
                  type: 'simple-fill',
                  color: [157, 223, 186],
                  outline: {
                    color: [0, 0, 0, 0.0],
                    width: 1,
                  },
                },
              },
              {
                type: 'polygon',
                rings: [
                  [106.80280297696845, 10.869228551247389],
                  [106.80281415551673, 10.869004368904214],
                  [106.80294064950544, 10.869004946694105],
                  [106.80293476606414, 10.869230862398709],
                  [106.80280297696845, 10.869228551247389],
                ],
                symbol: {
                  type: 'simple-fill',
                  color: [157, 223, 186],
                  outline: {
                    color: [0, 0, 0, 0.0],
                    width: 1,
                  },
                },
              },
            ],
          })};
          var createGraphic = function (data) {
            return new Graphic({
              geometry: data,
              symbol: data.symbol,
              attributes: data,
            });
          };
          var graphicsLayer = new GraphicsLayer();
          jsondata.polygons.forEach(function (data) {
            graphicsLayer.add(createGraphic(data));
          });
          jsondata.lines.forEach(function (data) {
            graphicsLayer.add(createGraphic(data));
          });
          jsondata.border.forEach(function (data) {
            graphicsLayer.add(createGraphic(data));
          });
          jsondata.tower.forEach(function (data) {
            graphicsLayer.add(createGraphic(data));
          });

          const town1 = new Point({
            x: 106.8016722,
            y: 10.8698529,
            z: 26.43,
          })

          Mesh.createFromGLTF(town1, "https://glb-model-ie402.web.app/ToaE.glb")
            .then(function (geometry) {
              geometry.scale(0.001, { origin: town1 })
              geometry.rotate(0, 0, 180);
              const graphic = new Graphic({
                geometry,
                symbol: {
                  type: "mesh-3d",
                  symbolLayers: [{
                    type: "fill"
                  }]
                },
                elevationInfo: {
                  mode: "relative-to-ground",
                  offset: 3
                }
              });
              sketchLayer.add(graphic)
            })
            .catch(console.error);

          const town2 = new Point({
            x: 106.8024522,
            y: 10.8699989,
            z: 26.43,
          })

          Mesh.createFromGLTF(town2, "https://glb-model-ie402.web.app/ToaA.glb")
            .then(function (geometry) {
              geometry.scale(1.05, { origin: town2 })
              geometry.rotate(0, 0, 225);
              const graphic = new Graphic({
                geometry,
                symbol: {
                  type: "mesh-3d",
                  symbolLayers: [{
                    type: "fill"
                  }]
                },
                elevationInfo: {
                  mode: "relative-to-ground",
                  offset: 3
                }
              });
              sketchLayer.add(graphic)
            })
            .catch(console.error);

          const town3 = new Point({
            x: 106.8007622,
            y: 10.8684989,
            z: 26.43,
          })

          Mesh.createFromGLTF(town3, "https://glb-model-ie402.web.app/ToaB.glb")
            .then(function (geometry) {
              geometry.scale(1, { origin: town3 })
              geometry.rotate(0, 0, 45);
              const graphic = new Graphic({
                geometry,
                symbol: {
                  type: "mesh-3d",
                  symbolLayers: [{
                    type: "fill"
                  }]
                },
                elevationInfo: {
                  mode: "relative-to-ground",
                  offset: 3
                }
              });
              sketchLayer.add(graphic)
            })
            .catch(console.error);

          map.add(graphicsLayer);
          map.add(sketchLayer);
        });
      </script>
    </head>

    <body>
      <div id="viewDiv"></div>
    </body>

    </html>
  `;

  return (
    <View className="flex-1 bg-white pt-16">
      <View className="flex-row items-center justify-between px-4 pb-3 pt-3">
        <TouchableOpacity
          onPress={async () => {
            router.back();
          }}
          className="bg-light flex items-center justify-center rounded-full p-2">
          <Back_light />
        </TouchableOpacity>

        <View className="flex-row justify-end gap-6 ">
          <TouchableOpacity
            onPress={() => router.push('/about-us')}
            className={`inline-flex items-center justify-center gap-2 rounded-[90px] px-4 py-2 ${
              isActive('/about-us') ? 'bg-normal' : 'bg-light'
            }`}>
            <Text
              className={`text-center text-lg font-normal ${
                isActive('/about-us') ? 'text-white' : 'text-normal'
              }`}>
              About Us
            </Text>
          </TouchableOpacity>
          <TouchableOpacity
            onPress={() => router.push('/login')}
            className={`inline-flex items-center justify-center gap-2 rounded-[90px] px-4 py-2 ${
              isActive('/login') ? 'bg-normal' : 'bg-light'
            }`}>
            <Text
              className={`text-center text-lg font-normal ${
                isActive('/login') ? 'text-white' : 'text-normal'
              }`}>
              Login
            </Text>
          </TouchableOpacity>
        </View>
      </View>
      <WebView
        source={{ html: htmlContent }}
        onError={(syntheticEvent) => {
          const { nativeEvent } = syntheticEvent;
          console.warn('WebView error: ', nativeEvent);
        }}
        onHttpError={(syntheticEvent) => {
          const { nativeEvent } = syntheticEvent;
          console.warn('WebView HTTP error: ', nativeEvent);
        }}
        javaScriptEnabled={true}
        domStorageEnabled={true}
        allowFileAccess={true}
        allowUniversalAccessFromFileURLs={true}
        allowFileAccessFromFileURLs={true}
        style={{ flex: 1 }}
        mixedContentMode="always"
      />
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
  },
});
